# Gán lại vào object
assayDataElement(exp_c_filtered, "corr") <- cor_mat
# Vẽ biểu đồ circos với các kết nối >=0.9
png("plots/exp_corr_plot.png", width = 25, height = 4, units = "in", res = 300)
plotCorrelation(
exp_c_filtered,
type = "circos"
)
dev.off()
exp_c <- correlation(exp_1, method.cor = "pearson",  warnings = FALSE)
# Tạo bản sao object gốc
exp_c_filtered <- exp_c
# Lấy ma trận tương quan
cor_mat <- assayDataElement(exp_c_filtered, "corr")
# Chỉ giữ các giá trị |r| >= 0.9
cor_mat[abs(cor_mat) < 0.9] <- 0  # hoặc NA nếu muốn bỏ hẳn các cạnh
# Gán lại vào object
assayDataElement(exp_c_filtered, "corr") <- cor_mat
# Vẽ biểu đồ circos với các kết nối >=0.9
png("plots/exp_corr_plot.png", width = 14, height = 14, units = "in", res = 300)
plotCorrelation(
exp_c_filtered,
type = "circos"
)
dev.off()
exp_c <- correlation(exp_1, method.cor = "pearson",  warnings = FALSE)
# Tạo bản sao object gốc
exp_c_filtered <- exp_c
# Lấy ma trận tương quan
cor_mat <- assayDataElement(exp_c_filtered, "corr")
# Chỉ giữ các giá trị |r| >= 0.9
cor_mat[abs(cor_mat) < 0.9] <- 0  # hoặc NA nếu muốn bỏ hẳn các cạnh
# Gán lại vào object
assayDataElement(exp_c_filtered, "corr") <- cor_mat
# Vẽ biểu đồ circos với các kết nối >=0.9
png("plots/exp_corr_plot.png", width = 10, height = 10, units = "in", res = 300)
plotCorrelation(
exp_c_filtered,
type = "circos"
)
dev.off()
exp_c <- correlation(exp_1, method.cor = "pearson",  warnings = FALSE)
# Tạo bản sao object gốc
exp_c_filtered <- exp_c
# Lấy ma trận tương quan
cor_mat <- assayDataElement(exp_c_filtered, "corr")
# Chỉ giữ các giá trị |r| >= 0.9
cor_mat[abs(cor_mat) < 0.9] <- 0  # hoặc NA nếu muốn bỏ hẳn các cạnh
# Gán lại vào object
assayDataElement(exp_c_filtered, "corr") <- cor_mat
# Vẽ biểu đồ circos với các kết nối >=0.9
png("plots/exp_corr_plot.png", width = 10, height = 7, units = "in", res = 300)
plotCorrelation(
exp_c_filtered,
type = "circos"
)
dev.off()
exp_c <- correlation(exp_1, method.cor = "pearson",  warnings = FALSE)
# Tạo bản sao object gốc
exp_c_filtered <- exp_c
# Lấy ma trận tương quan
cor_mat <- assayDataElement(exp_c_filtered, "corr")
# Chỉ giữ các giá trị |r| >= 0.9
cor_mat[abs(cor_mat) < 0.9] <- 0  # hoặc NA nếu muốn bỏ hẳn các cạnh
# Gán lại vào object
assayDataElement(exp_c_filtered, "corr") <- cor_mat
# Vẽ biểu đồ circos với các kết nối >=0.9
png("plots/exp_corr_plot.png", width = 10, height = 10, units = "in", res = 300)
plotCorrelation(
exp_c_filtered,
type = "circos"
)
dev.off()
tableMissings(exp_1, set = "exposures", output = "n")
tableMissings(exp_1, set = "phenotypes", output = "n")
png("plots/missing_plot.png", width = 10, height = 10, units = "in", res = 300)
plotMissings(exp_1, set = "exposures")
dev.off()
png("plots/pca_all_plot.png", width = 10, height = 10, units = "in", res = 300)
plotPCA(exp_pca, set = "all")
dev.off()
png("plots/pca_exps_plot.png", width = 10, height = 10, units = "in", res = 300)
plotPCA(exp_pca, set = "exposures", show.exposures = TRUE) +
ggtitle("Insulin resistance - PCA - Exposures Space") +
ggplot2::theme(legend.position = "bottom")
dev.off()
png("plots/pca_exps_plot.png", width = 10, height = 5, units = "in", res = 300)
plotPCA(exp_pca, set = "exposures", show.exposures = TRUE) +
ggtitle("Insulin resistance - PCA - Exposures Space") +
ggplot2::theme(legend.position = "bottom")
dev.off()
png("plots/pca_exps_plot.png", width = 7, height = 7, units = "in", res = 300)
plotPCA(exp_pca, set = "exposures", show.exposures = TRUE) +
ggtitle("Insulin resistance - PCA - Exposures Space") +
ggplot2::theme(legend.position = "bottom")
dev.off()
png("plots/pca_sampls_plot.png", width = 7, height = 7, units = "in", res = 300)
plotPCA(exp_pca, set = "samples", show.exposures = TRUE, show.samples = TRUE, phenotype = "insulin_re") +
ggtitle("Insulin resistance - PCA- Exposures Space") +
ggplot2::theme(legend.position = "bottom")
dev.off()
png("plots/pca_sampls_plot.png", width = 10, height = 7, units = "in", res = 300)
plotPCA(exp_pca, set = "samples", show.exposures = TRUE, show.samples = TRUE, phenotype = "insulin_re") +
ggtitle("Insulin resistance - PCA- Samples Space") +
ggplot2::theme(legend.position = "bottom")
dev.off()
png("plots/pca_samples_plot.png", width = 10, height = 7, units = "in", res = 300)
plotPCA(exp_pca, set = "samples", show.exposures = TRUE, show.samples = TRUE, phenotype = "insulin_re") +
ggtitle("Insulin resistance - PCA- Samples Space") +
ggplot2::theme(legend.position = "bottom")
dev.off()
png("plots/pca_corr_plot.png", width = 7, height = 7, units = "in", res = 300)
plotEXP(exp_pca)
dev.off()
png("plots/pca_corr_plot.png", width = 7, height = 7, units = "in", res = 300)
plotEXP(exp_pca)
dev.off()
hclust_data <- function(data, ...) {
hclust(d = dist(x = data), ...)
}
hclust_k5 <- function(result) {
cutree(result, k = 5)
}
exp_l <- clustering(exp_0, method = hclust_data, cmethod = hclust_k5)
png("plots/pca_corr_plot.png", width = 10, height = 10, units = "in", res = 300)
plotClassification(exp_l)
dev.off()
png("plots/pca_corr_plot.png", width = 7, height = 7, units = "in", res = 300)
plotEXP(exp_pca)
dev.off()
hclust_data <- function(data, ...) {
hclust(d = dist(x = data), ...)
}
hclust_k5 <- function(result) {
cutree(result, k = 5)
}
exp_l <- clustering(exp_0, method = hclust_data, cmethod = hclust_k5)
png("plots/clustering_plot.png", width = 10, height = 10, units = "in", res = 300)
plotClassification(exp_l)
dev.off()
hclust_data <- function(data, ...) {
hclust(d = dist(x = data), ...)
}
hclust_k5 <- function(result) {
cutree(result, k = 5)
}
exp_l <- clustering(exp_0, method = hclust_data, cmethod = hclust_k5)
png("plots/clustering_plot.png", width = 15, height = 10, units = "in", res = 300)
plotClassification(exp_l)
dev.off()
hclust_data <- function(data, ...) {
hclust(d = dist(x = data), ...)
}
hclust_k5 <- function(result) {
cutree(result, k = 5)
}
exp_l <- clustering(exp_0, method = hclust_data, cmethod = hclust_k5)
png("plots/clustering_plot.png", width = 15, height = 15, units = "in", res = 300)
plotClassification(exp_l)
dev.off()
png("plots/univariate_unadjusted_plot.png", width = 15, height = 15, units = "in", res = 300)
plotExwas(exwas_unadjusted, show.effective = TRUE) +
theme(legend.position = "right")
dev.off()
png("plots/univariate_unadjusted_plot.png", width = 15, height = 15, units = "in", res = 300)
plotExwas(exwas_unadjusted, show.effective = TRUE) +
geom_vline(
xintercept = -log10(0.05),    # ≈ 1.30103
color = "blue",
linetype = "dashed",
size = 1
) +
theme(legend.position = "right")
dev.off()
png("plots/univariate_unadjusted_plot.png", width = 15, height = 15, units = "in", res = 300)
plotExwas(exwas_unadjusted, show.effective = TRUE) +
geom_vline(
xintercept = -log10(0.05),    # ≈ 1.30103
color = "blue",
linetype = "dashed",
size = 0.5
) +
theme(legend.position = "right")
dev.off()
png("plots/univariate_unadjusted_plot.png", width = 7, height = 10, units = "in", res = 300)
plotExwas(exwas_unadjusted, show.effective = TRUE) +
geom_vline(
xintercept = -log10(0.05),    # ≈ 1.30103
color = "blue",
linetype = "dashed",
size = 0.5
) +
theme(legend.position = "right")
dev.off()
png("plots/univariate_unadjusted_plot.png", width = 7, height = 10, units = "in", res = 300)
plotExwas(exwas_unadjusted, show.effective = TRUE) +
geom_vline(
xintercept = -log10(0.05),    # ≈ 1.30103
color = "blue",
linetype = "dashed",
size = 1
) +
theme(legend.position = "right")
dev.off()
# Lấy dữ liệu ra từ kết quả ExWAS
df <- plotExwas(exwas_unadjusted, show.effective = TRUE)$data
# Thêm thông tin nhóm
desc <- fData(exwas_unadjusted)
# Lấy dữ liệu ra từ kết quả ExWAS
df <- plotExwas(exwas_unadjusted, show.effective = TRUE)$data
# Thêm thông tin nhóm
desc <- fData(exp_0)
df$Family <- desc$Family[match(df$Exposure, rownames(desc))]
exwas_unadjusted_result
class(exwas_unadjusted_result)
colnames(exwas_unadjusted_result)
rownames(exwas_unadjusted_result)
fData(exp_0)
dd
dd_1
dd_0
dd_0$exposure
dummy_df
exp_ordered <- dd_0$exposure
dummy_df <- as.data.frame()
exp_ordered <- dd_0$exposure
dummy_df <- data.frame()
dummy_df
exwas_unadjusted_result
exwas_unadjusted_result["LDL" , "pvalue"]
exwas_unadjusted_result["crude_protein" , "pvalue"]
exp_ordered <- dd_0$exposure
dummy_df <- data.frame()
for (x in exp_ordered) {
dummy_df <- rbind(dummy_df, c(x, exwas_unadjusted_result[x,"pvalue"]))
}
dummy_df
exp_ordered <- dd_0$exposure
dummy_df <- data.frame()
colnames(dummy_df) <- c("exposure", "pvalue")
exp_ordered <- dd_0$exposure
dummy_df <- data.frame(exposure = character(), pvalue = numeric(), stringsAsFactors = FALSE)
for (x in exp_ordered) {
dummy_df <- rbind(dummy_df, data.frame(
exposure = x,
pvalue = exwas_unadjusted_result[x, "pvalue"]
))
}
dummy_df
exp_ordered <- dd_0$exposure
exwas_unadjusted_result <- exwas_unadjusted_result[exp_ordered, ]
exwas_unadjusted_result
exp_ordered <- dd_0$exposure
exwas_unadjusted_result <- exwas_unadjusted_result[exp_ordered, ]
exwas_unadjusted_result <- round(exwas_unadjusted_result, 4)
exwas_unadjusted_result
exwas_unadjusted_result
exp_ordered <- dd_0$exposure
exwas_unadjusted_result <- exwas_unadjusted_result[exp_ordered, ]
exwas_unadjusted_result[ , sapply(exwas_unadjusted_result, is.character)] <-
round(exwas_unadjusted_result[ , sapply(exwas_unadjusted_result, is.character)], 4)
exp_ordered <- dd_0$exposure
exwas_unadjusted_result <- exwas_unadjusted_result[exp_ordered, ]
exwas_unadjusted_result[ , sapply(exwas_unadjusted_result, is.numeric)] <-
round(exwas_unadjusted_result[ , sapply(exwas_unadjusted_result, is.numeric)], 4)
exwas_unadjusted_result
exp_ordered <- dd_0$exposure
exwas_unadjusted_result <- exwas_unadjusted_result[exp_ordered, ]
exwas_unadjusted_result[] <- lapply(exwas_unadjusted_result, function(x) {
suppressWarnings(as.numeric(x))
})
# Làm tròn 4 chữ số thập phân
exwas_unadjusted_result <- round(exwas_unadjusted_result, 4)
exwas_unadjusted_result
exp_ordered <- dd_0$exposure
exwas_unadjusted_result <- exwas_unadjusted_result[exp_ordered, ]
exwas_unadjusted_result[] <- lapply(exwas_unadjusted_result, function(x) {
suppressWarnings(as.numeric(x))
})
# Làm tròn 4 chữ số thập phân
exwas_unadjusted_result <- round(exwas_unadjusted_result, 4)
exwas_unadjusted_result
write_xlsx(exwas_unadjusted_result, "tables/exwas_unadjusted_result")
exp_ordered <- dd_0$exposure
exwas_unadjusted_result <- exwas_unadjusted_result[exp_ordered, ]
exwas_unadjusted_result[] <- lapply(exwas_unadjusted_result, function(x) {
suppressWarnings(as.numeric(x))
})
# Làm tròn 4 chữ số thập phân
exwas_unadjusted_result <- round(exwas_unadjusted_result, 4)
exwas_unadjusted_result
write_xlsx(exwas_unadjusted_result, "tables/exwas_unadjusted_result.xlsx")
exwas_unadjusted <- exwas(
exp_0,
formula = insulin_re ~ 1,
family = "binomial",
warnings = FALSE
)
exwas_unadjusted_result <- as.data.frame(exwas_unadjusted@comparison)
exwas_unadjusted_result$exposure <- rownames(exwas_unadjusted_result)
exwas_unadjusted <- exwas(
exp_0,
formula = insulin_re ~ 1,
family = "binomial",
warnings = FALSE
)
exwas_unadjusted_result <- as.data.frame(exwas_unadjusted@comparison)
exp_ordered <- dd_0$exposure
exwas_unadjusted_result <- exwas_unadjusted_result[exp_ordered, ]
exwas_unadjusted_result[] <- lapply(exwas_unadjusted_result, function(x) {
suppressWarnings(as.numeric(x))
})
exwas_unadjusted_result <- round(exwas_unadjusted_result, 4)
exwas_unadjusted_result$exposure <- rownames(exwas_unadjusted_result)
write_xlsx(exwas_unadjusted_result, "tables/exwas_unadjusted_result.xlsx")
ggplot(exwas_unadjusted_result, aes(x = exposure, y = -log10(pvalue))) +
geom_point(size = 2, color = "red") +             # vẽ điểm
geom_hline(yintercept = -log10(0.05),           # ngưỡng p = 0.05
linetype = "dashed", color = "blue") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
labs(x = "Exposure", y = "-log10(P-value)",
title = "Manhattan-like plot for ExWAS")
exwas_adjusted <- exwas(
exp_0,
formula = insulin_re ~ sex + age + zbmi + calories,
family = "binomial",
warnings = FALSE
)
exwas_adjusted_result <- as.data.frame(exwas_adjusted@comparison)
# Xuất ra file kết quả
exp_ordered <- dd_0$exposure
exwas_adjusted_result <- exwas_adjusted_result[exp_ordered, ]
exwas_adjusted_result[] <- lapply(exwas_adjusted_result, function(x) {
suppressWarnings(as.numeric(x))
})
exwas_adjusted_result <- round(exwas_adjusted_result, 4)
exwas_adjusted_result$exposure <- rownames(exwas_adjusted_result)
write_xlsx(exwas_unadjusted_result, "tables/exwas_adjusted_result")
# Xuất ra file kết quả
exp_ordered <- dd_0$exposure
exwas_adjusted_result <- exwas_adjusted_result[exp_ordered, ]
exwas_adjusted_result[] <- lapply(exwas_adjusted_result, function(x) {
suppressWarnings(as.numeric(x))
})
exwas_adjusted_result <- round(exwas_adjusted_result, 4)
exwas_adjusted_result$exposure <- rownames(exwas_adjusted_result)
write_xlsx(exwas_unadjusted_result, "tables/exwas_adjusted_result.xlxs")
# Xuất ra file kết quả
exp_ordered <- dd_0$exposure
exwas_adjusted_result <- exwas_adjusted_result[exp_ordered, ]
exwas_adjusted_result[] <- lapply(exwas_adjusted_result, function(x) {
suppressWarnings(as.numeric(x))
})
exwas_adjusted_result <- round(exwas_adjusted_result, 4)
exwas_adjusted_result$exposure <- rownames(exwas_adjusted_result)
write_xlsx(exwas_unadjusted_result, "tables/exwas_adjusted_result.xlsx")
# Vẽ biểu đồ
png("plots/univariate_adjusted_plot.png", width = 7, height = 10, units = "in", res = 300)
plotExwas(exwas_adjusted, show.effective = TRUE) +
geom_vline(
xintercept = -log10(0.05),    # ≈ 1.30103
color = "blue",
linetype = "dashed",
size = 0.5
) +
theme(legend.position = "right")
dev.off()
# Vẽ biểu đồ
png("plots/univariate_adjusted_m_plot.png", width = 7, height = 10, units = "in", res = 300)
plotExwas(exwas_adjusted_male, show.effective = TRUE) +
geom_vline(
xintercept = -log10(0.05),    # ≈ 1.30103
color = "blue",
linetype = "dashed",
size = 0.5
) +
theme(legend.position = "right")
dev.off()
# Vẽ biểu đồ
png("plots/univariate_adjusted_f_plot.png", width = 7, height = 10, units = "in", res = 300)
plotExwas(exwas_adjusted_female, show.effective = TRUE) +
geom_vline(
xintercept = -log10(0.05),    # ≈ 1.30103
color = "blue",
linetype = "dashed",
size = 0.5
) +
theme(legend.position = "right")
dev.off()
# Xuất ra file kết quả
exp_ordered <- dd_0$exposure
exwas_adjusted_male_result <- exwas_adjusted_male_result[exp_ordered, ]
exwas_adjusted_male_result[] <- lapply(exwas_adjusted_male_result, function(x) {
suppressWarnings(as.numeric(x))
})
exwas_adjusted_male_result <- round(exwas_adjusted_male_result, 4)
exwas_adjusted_male_result$exposure <- rownames(exwas_adjusted_male_result)
write_xlsx(exwas_adjusted_male_result, "tables/exwas_adjusted_male_result.xlsx")
# Xuất ra file kết quả
exp_ordered <- dd_0$exposure
exwas_adjusted_female_result <- exwas_adjusted_female_result[exp_ordered, ]
exwas_adjusted_female_result[] <- lapply(exwas_adjusted_female_result, function(x) {
suppressWarnings(as.numeric(x))
})
exwas_adjusted_female_result <- round(exwas_adjusted_female_result, 4)
exwas_adjusted_female_result$exposure <- rownames(exwas_adjusted_female_result)
write_xlsx(exwas_adjusted_female_result, "tables/exwas_adjusted_female_result.xlsx")
loadings_matrix
exp_pca <- pca(exp_1, pca = TRUE)
loadings_matrix <- round(exp_pca@pca$var$coord, 4)
# loadings_matrix
write_xlsx(loadings_matrix, "tables/loadings_matrix.xlsx")
exp_pca <- pca(exp_1, pca = TRUE)
loadings_matrix <- as.data.frame(round(exp_pca@pca$var$coord, 4))
loadings_matrix
# write_xlsx(loadings_matrix, "tables/loadings_matrix.xlsx")
exp_pca <- pca(exp_1, pca = TRUE)
loadings_matrix <- as.data.frame(round(exp_pca@pca$var$coord, 4))
# loadings_matrix
write_xlsx(loadings_matrix, "tables/loadings_matrix.xlsx")
loadings_matrix
exp_pca <- pca(exp_1, pca = TRUE)
loadings_matrix <- as.data.frame(round(exp_pca@pca$var$coord, 4))
loadings_matrix$exposure <- rownames(loadings_matrix)
write_xlsx(loadings_matrix, "tables/loadings_matrix.xlsx")
# truy cập tên các đối tượng quan sát
head(sampleNames(exp_1))
# truy cập vào các biến số phơi nhiễm
head(exposureNames(exp_1))
# truy cập vào tên family trong description
head(familyNames(exp_1))
# truy cập vào confounder và outcome
head(phenotypeNames(exp_1))
# truy cập vào toàn bộ file descf
head(fData(exp_1))
# truy cập vào bảng dữ liệu phenotypes
head(pData(exp_1), n = 3)
exwas_adjusted
View(exwas_adjusted_male)
View(exwas_adjusted)
exp_ordered <- dd_0$exposure
exwas_adjusted <- exwas_adjusted[exwas_adjusted, ]
exp_ordered
exwas_adjusted@comparison@listData
class(exwas_adjusted@comparison@listData)
View(exwas_adjusted@comparison@listData)
extract(exwas_adjusted)
dummy_df <- extract(exwas_adjusted)
dummy_df
class(dummy_df)
exp_ordered <- dd_0$exposure
exp_ordered
# View(exwas_adjusted@comparison@listData)
dummy_df <- as.data.frame(extract(exwas_adjusted))
class(dummy_df)
exp_ordered <- dd_0$exposure
# View(exwas_adjusted@comparison@listData)
dummy_df <- as.data.frame(extract(exwas_adjusted))
class(dummy_df)
View(dummy_df)
# Xuất ra file kết quả
exp_ordered <- dd_0$exposure
exwas_adjusted_result <- exwas_adjusted_result[exp_ordered, ]
exwas_adjusted_result[] <- lapply(exwas_adjusted_result, function(x) {
suppressWarnings(as.numeric(x))
})
exwas_adjusted_result <- round(exwas_adjusted_result, 4)
exwas_adjusted_result$exposure <- rownames(exwas_adjusted_result)
write_xlsx(exwas_adjusted_result, "tables/exwas_adjusted_result.xlsx")
# Xuất ra file kết quả
exp_ordered <- dd_0$exposure
exwas_adjusted_result <- exwas_adjusted_result[exp_ordered, ]
exwas_adjusted_result[] <- lapply(exwas_adjusted_result, function(x) {
suppressWarnings(as.numeric(x))
})
exwas_adjusted_result <- round(exwas_adjusted_result, 4)
exwas_adjusted_result$exposure <- rownames(exwas_adjusted_result)
write_xlsx(exwas_adjusted_result, "tables/exwas_adjusted_result.xlsx")
exposureNames(exp_0)
View(exposureNames(exp_0))
exposureNames(exp_0)
exp_ordered <- dd_0$exposure
# View(exwas_adjusted@comparison@listData)
# dummy_df <- as.data.frame(extract(exwas_adjusted))
dummy_df <- as.data.frame(exwas_adjusted@comparison@listData)
class(dummy_df)
exposureNames(exp_0)
View(dummy_df)
# dummy_df <- as.data.frame(extract(exwas_adjusted))
dummy_df <- exwas_adjusted@comparison@listData
dummy_df
rownames(dummy_df)
exp_ordered <- dd_0$exposure
# View(exwas_adjusted@comparison@listData)
# dummy_df <- as.data.frame(extract(exwas_adjusted))
dummy_df <- as.data.frame(exwas_adjusted@comparison@listData)
class(dummy_df)
rownames(dummy_df)
# dummy_df <- as.data.frame(extract(exwas_adjusted))
dummy_df <- as.data.frame(exwas_adjusted@comparison)
exp_ordered <- dd_0$exposure
# View(exwas_adjusted@comparison@listData)
# dummy_df <- as.data.frame(extract(exwas_adjusted))
dummy_df <- as.data.frame(exwas_adjusted@comparison)
class(dummy_df)
rownames(dummy_df)
exp_1
exp_0
View(exp_0)
View(exwas_adjusted)
View(dummy_df)
