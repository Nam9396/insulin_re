")"
))
)
return(exwas_i)
})
strat_var <- "sex"
formula <- insulin_re ~ age + zbmi
strat_obj <- lapply(levels(as.factor(pData(inre_exp_t_s)[[strat_var]])), function(i) {
mask <- pData(inre_exp_t_s)[[strat_var]] == i
data_i <- inre_exp_t_s[ , mask]
exwas_i <- exwas(
data_i,
family = "binomial",
formula = formula
)
exwas_i@formula <- update.formula(exwas_i@formula, as.formula(paste0(
". ~ .",
"strata(",
strat_var,
"_",
gsub("[[:space:]]|-|+|(|)", "", i),
")"
)))
return(exwas_i)
})
do.call(plotExwas, strat_obj)
mexwas_model <- mexwas(inre_exp_t_s, phenotype = "insulin_re", family = "binomial")
# Lấy dữ liệu ra
df <- expos(inre_exp_s)[1:237, 1:34]
df_long <- reshape2::melt(df, variable.name = "Exposure", value.name = "Measure")
# Thêm cột Family (nếu có description file)
desc <- fData(inre_exp_s)
df_long$Family <- desc$Family[match(df_long$Exposure, rownames(desc))]
# Vẽ lại
ggplot(df_long, aes(x = Exposure, y = Measure, fill = Family)) +
geom_histogram(outlier.size = 1, alpha = 0.7) +
facet_wrap(~ Family, scales = "free_x", ncol = 3) +
theme_minimal(base_size = 12) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 9),
strip.text = element_text(face = "bold", size = 11),
panel.spacing = unit(1, "lines")
) +
labs(x = NULL, y = "Standardized Measure", title = "Exposure Distributions by Family")
# Lấy dữ liệu ra
df <- expos(inre_exp_s)[1:237, 1:34]
df_long <- reshape2::melt(df, variable.name = "Exposure", value.name = "Measure")
# Thêm cột Family (nếu có description file)
desc <- fData(inre_exp_s)
df_long$Family <- desc$Family[match(df_long$Exposure, rownames(desc))]
# Vẽ lại
ggplot(df_long, aes(x = Exposure, y = Measure, fill = Family)) +
geom_hist(outlier.size = 1, alpha = 0.7) +
facet_wrap(~ Family, scales = "free_x", ncol = 3) +
theme_minimal(base_size = 12) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 9),
strip.text = element_text(face = "bold", size = 11),
panel.spacing = unit(1, "lines")
) +
labs(x = NULL, y = "Standardized Measure", title = "Exposure Distributions by Family")
# Lấy dữ liệu ra
df <- expos(inre_exp_s)[1:237, 1:34]
df_long <- reshape2::melt(df, variable.name = "Exposure", value.name = "Measure")
# Thêm cột Family (nếu có description file)
desc <- fData(inre_exp_s)
df_long$Family <- desc$Family[match(df_long$Exposure, rownames(desc))]
# Vẽ lại
ggplot(df_long, aes(x = Exposure, y = Measure, fill = Family)) +
geom_boxplot(outlier.size = 1, alpha = 0.7) +
facet_wrap(~ Family, scales = "free_x", ncol = 3) +
theme_minimal(base_size = 12) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 9),
strip.text = element_text(face = "bold", size = 11),
panel.spacing = unit(1, "lines")
) +
labs(x = NULL, y = "Standardized Measure", title = "Exposure Distributions by Family")
ggplot(df_long, aes(x = Measure, fill = Family)) +
# 1. Thay geom_boxplot (hoặc geom_hist) bằng geom_histogram
geom_histogram(
aes(y = after_stat(density)), # Thường dùng density để so sánh dễ hơn, hoặc dùng count
bins = 30,                    # Số lượng bins (thanh)
alpha = 0.7,
position = "identity"         # Cho phép các histogram của các nhóm Family nằm đè lên nhau (nếu Family không dùng để facet)
) +
# 2. Bỏ 'Exposure' khỏi aes() chính và thay thế bằng facet_grid hoặc facet_wrap để chia biểu đồ
facet_wrap(Family ~ Exposure, scales = "free", ncol = 5) + # Chia theo Family VÀ Exposure
theme_minimal(base_size = 12) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 9),
strip.text = element_text(face = "bold", size = 8), # Giảm size vì số lượng facets lớn
panel.spacing = unit(0.5, "lines") # Giảm khoảng cách giữa các panel
) +
labs(x = "Standardized Measure", y = "Density", title = "Distribution of Standardized Exposures")
library(ggplot2)
library(reshape2)
# Lấy dữ liệu ra
df <- expos(inre_exp_s)[1:237, 1:34]
df_long <- melt(df, variable.name = "Exposure", value.name = "Measure")
# Thêm cột Family
desc <- fData(inre_exp_s)
df_long$Family <- desc$Family[match(df_long$Exposure, rownames(desc))]
# Vẽ histogram
ggplot(df_long, aes(x = Measure, fill = Family)) +
geom_histogram(bins = 30, alpha = 0.7, position = "identity") +
facet_wrap(~ Family + Exposure, scales = "free", ncol = 3) +
theme_minimal(base_size = 12) +
theme(
strip.text = element_text(face = "bold", size = 10),
panel.spacing = unit(1, "lines")
) +
labs(x = "Measure", y = "Count", title = "Histogram of Exposures by Family")
?trán
?trans
inre_exp_t <- trans(inre_exp, fun=log, by.exposure=TRUE)
inre_exp_t_s <- standardize(inre_exp_t, method="normal")
inre_exp_t_s
exp_pca <- pca(inre_exp_t_s, pca = TRUE)
if (!requireNamespace("devtools", quietly = TRUE))
install.packages("devtools")
if (!requireNamespace("BiocManager", quietly=TRUE))
install.packages("BiocManager")
packages = c('Biobase', 'mice', 'MultiDataSet', 'lsr', 'FactoMineR',
'stringr', 'circlize', 'corrplot', 'ggplot2', 'reshape2', 'pryr',
'scales', 'imputeLCMD', 'scatterplot3d', 'glmnet', 'gridExtra',
'grid', 'Hmisc', 'gplots', 'gtools', 'S4Vectors', 'MASS'
)
for( pkg in packages ) {
if( !pkg %in% rownames( installed.packages() ) ) {
message( "Installing ", pkg )
BiocManager::install( pkg )
}
}
if (!requireNamespace("rexposome", quietly = TRUE)) {
message("rexposome chưa được cài, tiến hành cài đặt...")
devtools::install_github("isglobal-brge/rexposome")
} else {
message("rexposome đã được cài đặt.")
}
library(tidyverse)   # xử lý, trực quan hóa dữ liệu
library(readxl)      # đọc file Excel (.xlsx)
library(writexl)     # một package khác để xuất file excel
library(psych)       # thống kê mô tả, kiểm định tâm lý
library(car)         # hồi quy, kiểm định mở rộng
library(mice)        # bù dữ liệu thiếu
library(naniar)      # kiểm tra & trực quan hóa dữ liệu thiếu
library(xtable)      # Chuyển bảng dữ liệu thành bảng LaTeX hoặc HTML (phục vụ xuất báo cáo)
library(gridExtra)   # Sắp xếp và kết hợp nhiều biểu đồ ggplot2 trên cùng một trang
library(Cairo)       # Xuất đồ họa chất lượng cao (PDF, PNG, SVG) với chống răng cưa và hỗ trợ in ấn
library(rexposome)      # Phân tích exposome: xử lý, mô tả và kiểm định liên quan exposome-kết cục
library(MASS)           # Hỗ trợ mô hình thống kê và phép biến đổi dữ liệu (ví dụ: Box-Cox)
library(MultiDataSet)   # Quản lý và tích hợp nhiều bộ dữ liệu omic hoặc exposome trong một đối tượng
library(corrplot)
path <- "../../data"
expof <- file.path(path, "exposome_data/exposures.csv")
descf <- file.path(path, "exposome_data/description.csv")
phenf <- file.path(path, "exposome_data/phenotypes.csv")
inre_exp<-readExposome(
exposures=expof,
description=descf,
phenotype=phenf,
sep= ",",
description.famCol="family",
description.expCol="exposure",
exposures.samCol="sub_id",
phenotype.samCol="sub_id"
)
dim(inre_exp) # (237: 34) + 5
# truy cập tên các đối tượng quan sát
head(sampleNames(inre_exp))
# truy cập vào các biến số phơi nhiễm
exposureNames(inre_exp)
# truy cập vào tên family trong description
familyNames(inre_exp)
# truy cập vào confounder và outcome
phenotypeNames(inre_exp)
# truy cập vào toàn bộ file descf
fData(inre_exp)
# truy cập vào bảng dữ liệu phenotypes
head(pData(inre_exp), n = 3)
tableMissings(inre_exp, set = "exposures", output = "n")
tableMissings(inre_exp, set = "phenotypes", output = "n")
plotMissings(inre_exp, set = "exposures")
nm <- normalityTest(inre_exp)
table(nm$normality)
nm$exposure[!nm$normality]
# vẽ box-plot cho tất cả các exposures theo family
plotFamily(inre_exp, family = "all")
# vẽ box-plot các exposure theo nhóm biến confounder
plotFamily(inre_exp, family = "Fat", group = "sex", group2 = "sex")
exp_std <- standardize(inre_exp, method = "normal")
plotFamily(exp_std, family = "all")
expo_best_trans <- function(var) {
var[var == 0] <- 0.00001 #to avoid problems with log(0)
bc <- boxcox(var ~ 1, plotit = FALSE)
trans <- bc$x[which.max(bc$y)]
if (trans < (-1.5)) {
x <- 1/(var^2)
} else if (trans < (-0.75) & trans > (-1.5)) {
x <- 1/(var)
} else if (trans < (-0.25) & trans > (-0.75)) {
x <- 1/(sqrt(var))
} else if (trans < (0.25) & trans > (-0.25)) {
x <- log(var)
} else if (trans < (0.75) & trans > (0.25)) {
x <- sqrt(var)
} else if (trans < (1.5) & trans > (0.75)) {
x <- var
} else {
x <- var^2
}
return(x)
}
# inre_exp_t <- trans(inre_exp, fun=expo_best_trans, by.exposure=TRUE)
inre_exp_t <- trans(inre_exp, fun=log, by.exposure=TRUE)
inre_exp_s <- standardize(inre_exp, method="normal")
inre_exp_s
inre_exp_t_s <- standardize(inre_exp_t, method="normal")
inre_exp_t_s
# Lấy dữ liệu ra
df <- expos(inre_exp_s)[1:237, 1:34]
df_long <- reshape2::melt(df, variable.name = "Exposure", value.name = "Measure")
# Thêm cột Family (nếu có description file)
desc <- fData(inre_exp_s)
df_long$Family <- desc$Family[match(df_long$Exposure, rownames(desc))]
# Vẽ lại
ggplot(df_long, aes(x = Exposure, y = Measure, fill = Family)) +
geom_boxplot(outlier.size = 1, alpha = 0.7) +
facet_wrap(~ Family, scales = "free_x", ncol = 3) +
theme_minimal(base_size = 12) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 9),
strip.text = element_text(face = "bold", size = 11),
panel.spacing = unit(1, "lines")
) +
labs(x = NULL, y = "Standardized Measure", title = "Exposure Distributions by Family")
inre_exp_c <- correlation(inre_exp, method.cor = "pearson")
# tạo ra ma trận các hệ số tương quan >= 0.9
cor_matrix <- extract(inre_exp_c)
mask <- abs(cor_matrix) >= 0.5
cor_matrix[!mask] <- 0
# print(cor_matrix[1:10, 1:10])
plotCorrelation(inre_exp_c, type = "circos")
# corrplot(cor_matrix, method="square")
# Tạo bản sao object gốc
inre_exp_c_filtered <- inre_exp_c
# Lấy ma trận tương quan
cor_mat <- assayDataElement(inre_exp_c_filtered, "corr")
# Chỉ giữ các giá trị |r| >= 0.9
cor_mat[abs(cor_mat) < 0.9] <- 0  # hoặc NA nếu muốn bỏ hẳn các cạnh
# Gán lại vào object
assayDataElement(inre_exp_c_filtered, "corr") <- cor_mat
# Vẽ biểu đồ circos với các kết nối >=0.9
plotCorrelation(
inre_exp_c_filtered,
type = "circos",
)
exp_pca <- pca(inre_exp_t_s, pca = TRUE)
library(tidyverse)   # xử lý, trực quan hóa dữ liệu
library(readxl)      # đọc file Excel (.xlsx)
library(openxlsx)    # ghi/xuất Excel
library(psych)       # thống kê mô tả, kiểm định tâm lý
library(car)         # hồi quy, kiểm định mở rộng
library(mice)        # bù dữ liệu thiếu
library(naniar)      # kiểm tra & trực quan hóa dữ liệu thiếu
library(writexl)     # một package khác để xuất file excel
df <- read_excel("../data/risk_factors.xlsx")
head(df)
View(df)
glimpse(df)
str(df)
miss_var_summary(df)
miss_var_summary(df)
df <- read_excel("../data/risk_factors.xlsx")
miss_var_summary(df)
View(miss_var_summary(df))
df <- read_excel("../data/risk_factors.xlsx")
View(miss_var_summary(df))
mcar_test(df)
?complete
imputed_df <- complete(pool_df, action=1)
View(miss_var_summary(imputed_df))
pool_df = mice(df, seed = 1234, printFlag = F)
imputed_df <- complete(pool_df, action=1)
View(miss_var_summary(imputed_df))
# write.csv(imputed_df, "imputed_data.csv", row.names = FALSE)
write_xlsx(imputed_df, "../data/imputed_data.xlsx")
if (!requireNamespace("devtools", quietly = TRUE))
install.packages("devtools")
if (!requireNamespace("BiocManager", quietly=TRUE))
install.packages("BiocManager")
packages = c('Biobase', 'mice', 'MultiDataSet', 'lsr', 'FactoMineR',
'stringr', 'circlize', 'corrplot', 'ggplot2', 'reshape2', 'pryr',
'scales', 'imputeLCMD', 'scatterplot3d', 'glmnet', 'gridExtra',
'grid', 'Hmisc', 'gplots', 'gtools', 'S4Vectors', 'MASS'
)
for( pkg in packages ) {
if( !pkg %in% rownames( installed.packages() ) ) {
message( "Installing ", pkg )
BiocManager::install( pkg )
}
}
if (!requireNamespace("rexposome", quietly = TRUE)) {
message("rexposome chưa được cài, tiến hành cài đặt...")
devtools::install_github("isglobal-brge/rexposome")
} else {
message("rexposome đã được cài đặt.")
}
library(tidyverse)   # xử lý, trực quan hóa dữ liệu
library(readxl)      # đọc file Excel (.xlsx)
library(writexl)     # một package khác để xuất file excel
library(psych)       # thống kê mô tả, kiểm định tâm lý
library(car)         # hồi quy, kiểm định mở rộng
library(mice)        # bù dữ liệu thiếu
library(naniar)      # kiểm tra & trực quan hóa dữ liệu thiếu
library(xtable)      # Chuyển bảng dữ liệu thành bảng LaTeX hoặc HTML (phục vụ xuất báo cáo)
library(gridExtra)   # Sắp xếp và kết hợp nhiều biểu đồ ggplot2 trên cùng một trang
library(Cairo)       # Xuất đồ họa chất lượng cao (PDF, PNG, SVG) với chống răng cưa và hỗ trợ in ấn
library(rexposome)      # Phân tích exposome: xử lý, mô tả và kiểm định liên quan exposome-kết cục
library(MASS)           # Hỗ trợ mô hình thống kê và phép biến đổi dữ liệu (ví dụ: Box-Cox)
library(MultiDataSet)   # Quản lý và tích hợp nhiều bộ dữ liệu omic hoặc exposome trong một đối tượng
library(corrplot)
path <- "../../data"
total_data <- file.path(path, "exposome_data/total_exwas_data.csv")
df <- read.csv(path, header = TRUE)
if (!requireNamespace("devtools", quietly = TRUE))
install.packages("devtools")
if (!requireNamespace("BiocManager", quietly=TRUE))
install.packages("BiocManager")
packages = c('Biobase', 'mice', 'MultiDataSet', 'lsr', 'FactoMineR',
'stringr', 'circlize', 'corrplot', 'ggplot2', 'reshape2', 'pryr',
'scales', 'imputeLCMD', 'scatterplot3d', 'glmnet', 'gridExtra',
'grid', 'Hmisc', 'gplots', 'gtools', 'S4Vectors', 'MASS'
)
for( pkg in packages ) {
if( !pkg %in% rownames( installed.packages() ) ) {
message( "Installing ", pkg )
BiocManager::install( pkg )
}
}
if (!requireNamespace("rexposome", quietly = TRUE)) {
message("rexposome chưa được cài, tiến hành cài đặt...")
devtools::install_github("isglobal-brge/rexposome")
} else {
message("rexposome đã được cài đặt.")
}
library(tidyverse)   # xử lý, trực quan hóa dữ liệu
library(readxl)      # đọc file Excel (.xlsx)
library(writexl)     # một package khác để xuất file excel
library(psych)       # thống kê mô tả, kiểm định tâm lý
library(car)         # hồi quy, kiểm định mở rộng
library(mice)        # bù dữ liệu thiếu
library(naniar)      # kiểm tra & trực quan hóa dữ liệu thiếu
library(xtable)      # Chuyển bảng dữ liệu thành bảng LaTeX hoặc HTML (phục vụ xuất báo cáo)
library(gridExtra)   # Sắp xếp và kết hợp nhiều biểu đồ ggplot2 trên cùng một trang
library(Cairo)       # Xuất đồ họa chất lượng cao (PDF, PNG, SVG) với chống răng cưa và hỗ trợ in ấn
library(rexposome)      # Phân tích exposome: xử lý, mô tả và kiểm định liên quan exposome-kết cục
library(MASS)           # Hỗ trợ mô hình thống kê và phép biến đổi dữ liệu (ví dụ: Box-Cox)
library(MultiDataSet)   # Quản lý và tích hợp nhiều bộ dữ liệu omic hoặc exposome trong một đối tượng
library(corrplot)
path <- "../../data"
total_data <- file.path(path, "exposome_data/total_exwas_data.csv")
df <- read.csv(total_data, header = TRUE)
df
View(df)
View(df)
path <- "../../data"
total_data <- file.path(path, "exposome_data/total_exwas_data.csv")
df <- read.csv(total_data, header = TRUE)
exp <- loadExposome_plain(
data = df,
data_id = "sub_id",
pheno_cols = c('age', 'zbmi', 'sex', 'insulin_re'),
families = list(
Prenatal = c('pregnancy_smoking', 'GDM', 'gestational_weight_gain'),
Perinatal = c('preterm_birth', 'gestational_age_week', 'birth_weight_gram'),
Postnatal = c('CPP', 'exclusive_breastfeeding_month', 'mixed_breastfeeding_month'),
Biomaker = c('cholesterol', 'TG', 'HDL', 'cortisol'),
Family = c('family_income', 'father_diabetes', 'mother_diabetes', 'education_level', 'father_BMI', 'mother_BMI'),
Activity = c('sedentary_lifestyle_hour_day', 'low_physical_activity_hour_day'),
Sleep = c('sleep_duration', 'PSQI_score', 'snoring_times_week', 'sleep_apnea_times_week'),
Psycho = c('score_5A', 'PSS', 'score_5B', 'CES_D', 'score_5C', 'RSE'),
Calories = c('Calories'),
Protein = c('Crude protein', 'EAA', 'NEAA', 'PLMF', 'PHSF'),
Fat = c('Crude fat', 'Trans fat', 'TFA_S', 'TFA_M', 'TFA_P', 'Cholesterol', 'Seeds'),
Carbohydrates = c('Total carbohydrate', 'Whole Rhizome', 'Monosaccharides', 'Disaccharides'),
"Water & fruits & vegetables" = c('Water', 'Fruit', 'Vegetable', 'Dietary fiber'),
Diary = c('Dairy fullfat', 'Dairy skim & lowfat'),
Ions = c('Sodium', 'Potassium', 'Calcium', 'Magnesium', 'Phosphorus', 'Iron', 'Zinc'),
Vitamins = c('VitA', 'VitB', 'VitC', 'VitE')
)
)
df <- read.csv(total_data, header = TRUE)
exp <- loadExposome_plain(
data = df,
data_id = "sub_id",
pheno_cols = c('age', 'zbmi', 'sex', 'insulin_re'),
families = list(
Prenatal = c('pregnancy_smoking', 'GDM', 'gestational_weight_gain'),
Perinatal = c('preterm_birth', 'gestational_age_week', 'birth_weight_gram'),
Postnatal = c('CPP', 'exclusive_breastfeeding_month', 'mixed_breastfeeding_month'),
Biomaker = c('cholesterol', 'TG', 'HDL', 'cortisol'),
Family = c('family_income', 'father_diabetes', 'mother_diabetes', 'education_level', 'father_BMI', 'mother_BMI'),
Activity = c('sedentary_lifestyle_hour_day', 'low_physical_activity_hour_day'),
Sleep = c('sleep_duration', 'PSQI_score', 'snoring_times_week', 'sleep_apnea_times_week'),
Psycho = c('score_5A', ),
Calories = c('Calories'),
Protein = c('Crude protein', 'EAA', 'NEAA', 'PLMF', 'PHSF'),
Fat = c('Crude fat', 'Trans fat', 'TFA_S', 'TFA_M', 'TFA_P', 'Cholesterol', 'Seeds'),
Carbohydrates = c('Total carbohydrate', 'Whole Rhizome', 'Monosaccharides', 'Disaccharides'),
"Water & fruits & vegetables" = c('Water', 'Fruit', 'Vegetable', 'Dietary fiber'),
Diary = c('Dairy fullfat', 'Dairy skim & lowfat'),
Ions = c('Sodium', 'Potassium', 'Calcium', 'Magnesium', 'Phosphorus', 'Iron', 'Zinc'),
Vitamins = c('VitA', 'VitB', 'VitC', 'VitE')
)
)
df <- read.csv(total_data, header = TRUE)
exp <- loadExposome_plain(
data = df,
data_id = "sub_id",
pheno_cols = c('age', 'zbmi', 'sex', 'insulin_re'),
families = list(
Prenatal = c('pregnancy_smoking', 'GDM', 'gestational_weight_gain'),
Perinatal = c('preterm_birth', 'gestational_age_week', 'birth_weight_gram'),
Postnatal = c('CPP', 'exclusive_breastfeeding_month', 'mixed_breastfeeding_month'),
Biomaker = c('cholesterol', 'TG', 'HDL', 'cortisol'),
Family = c('family_income', 'father_diabetes', 'mother_diabetes', 'education_level', 'father_BMI', 'mother_BMI'),
Activity = c('sedentary_lifestyle_hour_day', 'low_physical_activity_hour_day'),
Sleep = c('sleep_duration', 'PSQI_score', 'snoring_times_week', 'sleep_apnea_times_week'),
Psycho = c('score_5A'),
Calories = c('Calories'),
Protein = c('Crude protein', 'EAA', 'NEAA', 'PLMF', 'PHSF'),
Fat = c('Crude fat', 'Trans fat', 'TFA_S', 'TFA_M', 'TFA_P', 'Cholesterol', 'Seeds'),
Carbohydrates = c('Total carbohydrate', 'Whole Rhizome', 'Monosaccharides', 'Disaccharides'),
"Water & fruits & vegetables" = c('Water', 'Fruit', 'Vegetable', 'Dietary fiber'),
Diary = c('Dairy fullfat', 'Dairy skim & lowfat'),
Ions = c('Sodium', 'Potassium', 'Calcium', 'Magnesium', 'Phosphorus', 'Iron', 'Zinc'),
Vitamins = c('VitA', 'VitB', 'VitC', 'VitE')
)
)
View(df)
df <- read.csv(total_data, header = TRUE)
exp <- loadExposome_plain(
data = df,
data_id = "sub_id",
pheno_cols = c('age', 'zbmi', 'sex', 'insulin_re'),
families = list(
Prenatal = c('pregnancy_smoking', 'GDM', 'gestational_weight_gain'),
Perinatal = c('preterm_birth', 'gestational_age_week', 'birth_weight_gram'),
Postnatal = c('CPP', 'exclusive_breastfeeding_month', 'mixed_breastfeeding_month'),
Biomaker = c('cholesterol', 'TG', 'HDL', 'cortisol'),
Family = c('family_income', 'father_diabetes', 'mother_diabetes', 'education_level', 'father_BMI', 'mother_BMI'),
Activity = c('sedentary_lifestyle_hour_day', 'low_physical_activity_hour_day'),
Sleep = c('sleep_duration', 'PSQI_score', 'snoring_times_week', 'sleep_apnea_times_week'),
Psycho = c('score_5A', 'PSS', 'score_5B', 'CES_D', 'score_5C', 'RSE'),
Calories = c('Calories'),
Protein = c('Crude.protein', 'EAA', 'NEAA', 'PLMF', 'PHSF'),
Fat = c('Crude.fat', 'Trans.fat', 'TFA_S', 'TFA_M', 'TFA_P', 'Cholesterol', 'Seeds'),
Carbohydrates = c('Total.carbohydrate', 'Whole.Rhizome', 'Monosaccharides', 'Disaccharides'),
"Water & fruits & vegetables" = c('Water', 'Fruit', 'Vegetable', 'Dietary.fiber'),
Diary = c('Dairy.fullfat', 'Dairy.skim...lowfat'),
Ions = c('Sodium', 'Potassium', 'Calcium', 'Magnesium', 'Phosphorus', 'Iron', 'Zinc'),
Vitamins = c('VitA', 'VitB', 'VitC', 'VitE')
)
)
colnames(df) <- make.names(colnames(df), unique = TRUE)
View(df)
df <- read.csv(total_data, header = TRUE)
View(df)
df <- read.csv(total_data, header = TRUE)
families = list(
Prenatal = c('pregnancy_smoking', 'GDM', 'gestational_weight_gain'),
Perinatal = c('preterm_birth', 'gestational_age_week', 'birth_weight_gram'),
Postnatal = c('CPP', 'exclusive_breastfeeding_month', 'mixed_breastfeeding_month'),
Biomaker = c('cholesterol', 'TG', 'HDL', 'cortisol'),
Family = c('family_income', 'father_diabetes', 'mother_diabetes', 'education_level', 'father_BMI', 'mother_BMI'),
Activity = c('sedentary_lifestyle_hour_day', 'low_physical_activity_hour_day'),
Sleep = c('sleep_duration', 'PSQI_score', 'snoring_times_week', 'sleep_apnea_times_week'),
Psycho = c('score_5A', 'PSS', 'score_5B', 'CES_D', 'score_5C', 'RSE'),
Calories = c('Calories'),
Protein = c('Crude.protein', 'EAA', 'NEAA', 'PLMF', 'PHSF'),
Fat = c('Crude.fat', 'Trans.fat', 'TFA_S', 'TFA_M', 'TFA_P', 'Cholesterol', 'Seeds'),
Carbohydrates = c('Total.carbohydrate', 'Whole.Rhizome', 'Monosaccharides', 'Disaccharides'),
"Water & fruits & vegetables" = c('Water', 'Fruit', 'Vegetable', 'Dietary.fiber'),
Diary = c('Dairy.fullfat', 'Dairy.skim...lowfat'),
Ions = c('Sodium', 'Potassium', 'Calcium', 'Magnesium', 'Phosphorus', 'Iron', 'Zinc'),
Vitamins = c('VitA', 'VitB', 'VitC', 'VitE')
)
setdiff(unlist(families), colnames(df))
exp <- loadExposome_plain(
data = df,
data_id = "sub_id",
pheno_cols = c('age', 'zbmi', 'sex', 'insulin_re'),
families = families
)
# 1. Chuẩn hóa tên cột df: R tự động xử lý khoảng trắng, ký tự đặc biệt và đảm bảo duy nhất
colnames(df) <- make.names(colnames(df), unique = TRUE)
# 2. Chuẩn hóa families tự động theo tên df mới
families <- lapply(families, function(x) make.names(x, unique = TRUE))
# 3. Kiểm tra tất cả biến đều tồn tại
missing_vars <- setdiff(unlist(families), colnames(df))
if(length(missing_vars) > 0) {
stop("Các biến sau chưa có trong df: ", paste(missing_vars, collapse = ", "))
}
# 4. Load exposome object
exp <- loadExposome_plain(
data = df,
data_id = "sub_id",
pheno_cols = make.names(c('age', 'zbmi', 'sex', 'insulin_re')),
families = families
)
